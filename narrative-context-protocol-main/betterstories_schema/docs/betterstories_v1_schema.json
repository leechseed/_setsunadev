{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Narrative Context Protocol Schema",
  "description": "A lean, refactored protocol for structuring narrative elements in multi-agent systems.",
  "type": "object",
  "required": [
    "schema_version",
    "story",
    "storypointTable"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "1.0"
    },
    "story": {
      "$ref": "#/$defs/Story"
    },
    "storypointTable": {
      "type": "array",
      "description": "Master Dramatica Storypoint Table",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "squad": {
            "type": "string"
          },
          "platoon": {
            "type": "string"
          },
          "company": {
            "type": "string"
          },
          "battalion": {
            "type": "string"
          },
          "regiment": {
            "type": "string"
          },
          "division": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "name",
          "squad",
          "platoon",
          "company",
          "battalion",
          "regiment",
          "division"
        ],
        "additionalProperties": false
      }
    }
  },
  "$defs": {
    "IDSummary": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "summary": {
          "type": "string"
        },
        "storytelling": {
          "type": "string"
        }
      },
      "required": [
        "id",
        "name",
        "summary",
        "storytelling"
      ],
      "additionalProperties": false
    },
    "PovEnum": {
      "type": "string",
      "enum": [
        "i",
        "you",
        "we",
        "they"
      ]
    },
    "Perspective": {
      "allOf": [
        {
          "$ref": "#/$defs/IDSummary"
        },
        {
          "type": "object",
          "properties": {
            "author_structural_pov": {
              "$ref": "#/$defs/PovEnum"
            }
          },
          "required": [
            "author_structural_pov"
          ],
          "additionalProperties": false
        }
      ]
    },
    "PerspectiveArray": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Perspective"
      }
    },
    "Player": {
      "allOf": [
        {
          "$ref": "#/$defs/IDSummary"
        },
        {
          "type": "object",
          "properties": {
            "role": {
              "type": "string"
            },
            "visual": {
              "type": "string"
            },
            "audio": {
              "type": "string"
            },
            "perspectives": {
              "$ref": "#/$defs/PerspectiveArray"
            }
          },
          "required": [
            "role",
            "visual",
            "audio",
            "perspectives"
          ],
          "additionalProperties": false
        }
      ]
    },
    "DynamicEnum": {
      "type": "string",
      "enum": [
        "i_perspective_resolve",
        "you_perspective_resolve",
        "growth",
        "approach",
        "alignment",
        "fabric",
        "driver",
        "ending",
        "attunement",
        "outcome",
        "judgment",
        "balance",
        "vibes"
      ]
    },
    "VectorEnum": {
      "type": "string",
      "enum": [
        "change",
        "steadfast",
        "released",
        "sustained",
        "stop",
        "start",
        "do_er",
        "be_er",
        "linear",
        "holistic",
        "options",
        "time",
        "action",
        "decision",
        "success",
        "failure",
        "harmony",
        "discord",
        "good",
        "bad",
        "higher",
        "lower"
      ]
    },
    "Dynamic": {
      "allOf": [
        {
          "$ref": "#/$defs/IDSummary"
        },
        {
          "type": "object",
          "properties": {
            "dynamic": {
              "$ref": "#/$defs/DynamicEnum"
            },
            "vector": {
              "$ref": "#/$defs/VectorEnum"
            }
          },
          "required": [
            "dynamic",
            "vector"
          ],
          "additionalProperties": false
        }
      ]
    },
    "AppreciationEnum": {
      "type": "string",
      "enum": [
        "domain",
        "concern",
        "issue",
        "problem",
        "solution",
        "focus",
        "direction",
        "condition",
        "adjustment",
        "resistance",
        "flow",
        "catalyst",
        "inhibitor",
        "unique_ability",
        "critical_flaw",
        "benchmark"
      ]
    },
    "MethodEnum": {
      "type": "string",
      "enum": [
        "past",
        "present",
        "future",
        "understanding",
        "memory",
        "progress",
        "action",
        "conditioning",
        "fantasy",
        "responsibility",
        "choice",
        "strategy",
        "evaluation",
        "trust",
        "temptation",
        "support"
      ]
    },
    "StoryPoint": {
      "allOf": [
        {
          "$ref": "#/$defs/IDSummary"
        },
        {
          "type": "object",
          "properties": {
            "squad": {
              "type": "string"
            },
            "platoon": {
              "type": "string"
            },
            "company": {
              "type": "string"
            },
            "battalion": {
              "type": "string"
            },
            "regiment": {
              "type": "string"
            },
            "division": {
              "type": "string"
            },
            "appreciation": {
              "$ref": "#/$defs/AppreciationEnum"
            },
            "method": {
              "$ref": "#/$defs/MethodEnum"
            },
            "illustration": {
              "type": "string"
            },
            "perspectives": {
              "$ref": "#/$defs/PerspectiveArray"
            }
          },
          "required": [
            "squad",
            "platoon",
            "company",
            "battalion",
            "regiment",
            "division",
            "appreciation",
            "method",
            "illustration",
            "perspectives"
          ],
          "additionalProperties": false
        }
      ]
    },
    "AppreciationBeatEnum": {
      "type": "string",
      "enum": [
        "transit",
        "progression",
        "event"
      ]
    },
    "SequenceRules": {
      "oneOf": [
        {
          "properties": {
            "appreciation": {
              "const": "transit"
            },
            "sequence": {
              "type": "integer",
              "minimum": 1,
              "maximum": 4
            }
          }
        },
        {
          "properties": {
            "appreciation": {
              "const": "progression"
            },
            "sequence": {
              "type": "integer",
              "minimum": 1,
              "maximum": 16
            }
          }
        },
        {
          "properties": {
            "appreciation": {
              "const": "event"
            },
            "sequence": {
              "type": "integer",
              "minimum": 1,
              "maximum": 64
            }
          }
        }
      ]
    },
    "ToneAbstractionEnum": {
      "type": "string",
      "enum": [
        "situation",
        "action",
        "justification",
        "opinion"
      ]
    },
    "ToneSpatialEnum": {
      "type": "string",
      "enum": [
        "potential",
        "resistance",
        "current",
        "power"
      ]
    },
    "ToneTemporalEnum": {
      "type": "string",
      "enum": [
        "expression",
        "experimentation",
        "integration",
        "transcendence"
      ]
    },
    "StoryBeat": {
      "allOf": [
        {
          "$ref": "#/$defs/IDSummary"
        },
        {
          "type": "object",
          "properties": {
            "appreciation": {
              "$ref": "#/$defs/AppreciationBeatEnum"
            },
            "sequence": {
              "$ref": "#/$defs/SequenceRules"
            },
            "method": {
              "$ref": "#/$defs/MethodEnum"
            },
            "illustration": {
              "type": "string"
            },
            "tones": {
              "type": "object",
              "properties": {
                "abstraction": {
                  "$ref": "#/$defs/ToneAbstractionEnum"
                },
                "spatial": {
                  "$ref": "#/$defs/ToneSpatialEnum"
                },
                "temporal": {
                  "$ref": "#/$defs/ToneTemporalEnum"
                }
              },
              "required": [
                "abstraction",
                "spatial",
                "temporal"
              ],
              "additionalProperties": false
            },
            "perspectives": {
              "$ref": "#/$defs/PerspectiveArray"
            }
          },
          "required": [
            "appreciation",
            "sequence",
            "method",
            "illustration",
            "tones",
            "perspectives"
          ],
          "additionalProperties": false
        }
      ]
    },
    "Moment": {
      "allOf": [
        {
          "$ref": "#/$defs/IDSummary"
        },
        {
          "type": "object",
          "properties": {
            "synopsis": {
              "type": "string"
            },
            "setting": {
              "type": "string"
            },
            "timing": {
              "type": "string"
            },
            "imperatives": {
              "type": "string"
            },
            "fabric": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "space",
                      "time"
                    ]
                  },
                  "limit": {
                    "type": "integer"
                  }
                },
                "required": [
                  "type",
                  "limit"
                ],
                "additionalProperties": false
              }
            },
            "audience_experiential_pov": {
              "type": "string",
              "enum": [
                "first_person_central",
                "first_person_peripheral",
                "second_person",
                "third_person_limited",
                "third_person_objective",
                "third_person_omniscient"
              ]
            },
            "storybeats": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "sequence": {
                    "type": "integer"
                  },
                  "storybeat_id": {
                    "type": "string"
                  }
                },
                "required": [
                  "sequence",
                  "storybeat_id"
                ],
                "additionalProperties": false
              }
            }
          },
          "required": [
            "synopsis",
            "setting",
            "timing",
            "imperatives",
            "fabric",
            "audience_experiential_pov",
            "storybeats"
          ],
          "additionalProperties": false
        }
      ]
    },
    "Storytelling": {
      "type": "object",
      "properties": {
        "overviews": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/IDSummary"
          }
        },
        "moments": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Moment"
          }
        }
      },
      "additionalProperties": false
    },
    "Narrative": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "perspectives": {
          "$ref": "#/$defs/PerspectiveArray"
        },
        "players": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Player"
          }
        },
        "dynamics": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Dynamic"
          }
        },
        "storypoints": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/StoryPoint"
          }
        },
        "storybeats": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/StoryBeat"
          }
        },
        "storytelling": {
          "$ref": "#/$defs/Storytelling"
        }
      },
      "required": [
        "id",
        "title",
        "perspectives",
        "players",
        "dynamics",
        "storypoints",
        "storybeats",
        "storytelling"
      ],
      "additionalProperties": false
    },
    "Story": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "genre": {
          "type": "string"
        },
        "logline": {
          "type": "string"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "narratives": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Narrative"
          }
        }
      },
      "required": [
        "id",
        "title",
        "genre",
        "logline",
        "created_at",
        "narratives"
      ],
      "additionalProperties": false
    }
  }
}