id: 743a0410ecbc4ce2976b0b064a9ffea4
parent_id: 
item_type: 1
item_id: 3a3bd26629174b1aa1a8e3876b58869f
item_updated_time: 1759083721079
title_diff: "[{\"diffs\":[[1,\"README — Full System: SlimeVR Body Tracking + ARKit Facial Capture\"]],\"start1\":0,\"start2\":0,\"length1\":0,\"length2\":66}]"
body_diff: "[{\"diffs\":[[1,\"# README — Full System: SlimeVR Body Tracking + ARKit Facial Capture\\\n\\\n> Straight to the point: this system uses **SlimeVR-style IMU trackers** for full-body **rotations** and **ARKit** (iPhone with TrueDepth) for **facial blendshapes**. No base stations. No optical tracking. Expect excellent expressiveness and portable setup, with the usual IMU caveats (yaw drift over long takes, no absolute position).\\\n\\\n---\\\n\\\n## Table of Contents\\\n\\\n* [1. System Overview](#1-system-overview)\\\n* [2. What Each Part Does (Ownership)](#2-what-each-part-does-ownership)\\\n* [3. Hardware](#3-hardware)\\\n\\\n  * [3.1 Tracker BOM (per node)](#31-tracker-bom-per-node)\\\n  * [3.2 Recommended Node Count & Placement](#32-recommended-node-count--placement)\\\n  * [3.3 Enclosures & Mounting](#33-enclosures--mounting)\\\n  * [3.4 Power & Charging](#34-power--charging)\\\n* [4. Firmware & On-Node Settings](#4-firmware--on-node-settings)\\\n* [5. Networking & Transport](#5-networking--transport)\\\n* [6. Host Software Stack](#6-host-software-stack)\\\n\\\n  * [6.1 SlimeVR Server](#61-slimevr-server)\\\n  * [6.2 Facial Capture (ARKit)](#62-facial-capture-arkit)\\\n  * [6.3 Engine Integration (pick one)](#63-engine-integration-pick-one)\\\n* [7. Time Sync & Latency Strategy](#7-time-sync--latency-strategy)\\\n* [8. Calibration & Session Workflow](#8-calibration--session-workflow)\\\n* [9. Data Formats & Rates](#9-data-formats--rates)\\\n* [10. Rig & Retargeting](#10-rig--retargeting)\\\n* [11. Quality Tips (What Actually Matters)](#11-quality-tips-what-actually-matters)\\\n* [12. Troubleshooting](#12-troubleshooting)\\\n* [13. Maintenance & Safety](#13-maintenance--safety)\\\n* [14. Extensions & Variants](#14-extensions--variants)\\\n* [15. Quick Checklists](#15-quick-checklists)\\\n\\\n---\\\n\\\n## 1. System Overview\\\n\\\n```mermaid\\\nflowchart LR\\\n  subgraph Wearer\\\n    A1[IMU Nodes xN\\\\\n(ESP32-S3 + BNO085)]\\\n    A2[iPhone (TrueDepth)\\\\\nARKit Face App]\\\n  end\\\n\\\n  A1 -- UDP (Wi-Fi) --> B1[SlimeVR Server\\\\\n(on PC)]\\\n  A2 -- Wi-Fi --> C1[Face Receiver\\\\\n(Engine plugin/app/OSC)]\\\n\\\n  B1 -- body quats --> D[Engine (Unreal/Unity/Blender)]\\\n  C1 -- blendshapes --> D\\\n  D --> E[Character Rig\\\\\n(Retarget + Facial Rig)]\\\n```\\\n\\\n* **Body**: SlimeVR trackers stream **quaternions** (rotations only) to SlimeVR Server → engine.\\\n* **Face**: iPhone streams **ARKit blendshapes** (+ optional head pose) to engine.\\\n* **No absolute position**: all body motion is solved via IK. Root/feet won’t have real world coordinates—accept it or add anchors later (not in this build).\\\n\\\n---\\\n\\\n## 2. What Each Part Does (Ownership)\\\n\\\n| Component         | Owns                                                          | Why                                                   |\\\n| ----------------- | ------------------------------------------------------------- | ----------------------------------------------------- |\\\n| **SlimeVR nodes** | Body **bone rotations** (hips, spine, head, arms, legs, feet) | High-rate IMU quats are smooth; IK handles positions. |\\\n| **ARKit**         | **Facial blendshapes** (and optionally eye/gaze)              | Best-in-class face fidelity on consumer gear.         |\\\n| **Engine**        | **Skeleton solve & retarget**                                 | One rig, one place to blend face/body and export.     |\\\n\\\n**Head orientation rule:** Use the **head IMU** for head rotation. Apply ARKit face **as local offsets** on the head/face rig. Don’t let ARKit head pose and IMU fight.\\\n\\\n---\\\n\\\n## 3. Hardware\\\n\\\n### 3.1 Tracker BOM (per node)\\\n\\\n* **IMU:** BNO085/BNO080 (Hillcrest SH-2 fusion).\\\n* **MCU/Radio:** ESP32-S3 dev board (USB-C; onboard LiPo charger preferred).\\\n* **Battery:** LiPo 3.7 V, **750–1000 mAh** (≈6–10 h).\\\n* **Switch & wiring:** Mini slide switch, JST-PH leads, short SPI (or short I²C) harness.\\\n* **Case & strap:** 3D-printed PETG/ABS case; elastic/Velcro strap; M2 standoffs.\\\n\\\n**Cost per node:** ~$45–70 (realistic).\\\n\\\n### 3.2 Recommended Node Count & Placement\\\n\\\nTen-node layout (rock-solid body solve without overkill):\\\n\\\n1. Hips/Pelvis (belt line, center)\\\n2. Lower Spine (navel)\\\n3. Upper Chest (sternum)\\\n4. Head (headband/cap)\\\n   5–6. Upper Arms L/R (lateral deltoid)\\\n   7–8. Forearms L/R (dorsal mid-forearm)\\\n   9–10. Feet L/R (instep/laces)\\\n\\\n> Feet, not shins: better foot-plant detection and less skate with IMU-only rigs.\\\n\\\n### 3.3 Enclosures & Mounting\\\n\\\n* **Rigid** mount (no wobble).\\\n* **Orientation marks** on case (“UP”, “FWD”).\\\n* Keep IMU away from **magnets** (headphones, buck inductors).\\\n* Straps tight but not cutting off circulation. Soft pads if needed.\\\n\\\n### 3.4 Power & Charging\\\n\\\n* Draw: ~80–120 mA per node @ 100–200 Hz Wi-Fi.\\\n* Runtime: **750–1000 mAh → 6–10 h**.\\\n* Bench: multi-port USB-C charger for the fleet.\\\n* Swap LiPos yearly under heavy use (300–500 cycles).\\\n\\\n---\\\n\\\n## 4. Firmware & On-Node Settings\\\n\\\n* **Fusion:** BNO085 **Game Rotation Vector** (gyro+accel; **mag off** indoors).\\\n* **Internal update:** 400 Hz; **publish 100–200 Hz**.\\\n* **Packet:** timestamp (µs) + quaternion (Q15 fixed-point) + id + flags (~20–24 B).\\\n* **Transport:** **Wi-Fi UDP** (SlimeVR default).\\\n* **Per-node ID:** hardcode names matching mount (HIPS, CHEST, …).\\\n* **Warm-up:** 60–120 s before recording.\\\n* **Stillness rebias:** enabled; let nodes recalibrate when actor stands idle.\\\n\\\n---\\\n\\\n## 5. Networking & Transport\\\n\\\n* Dedicated **5 GHz** SSID for trackers + iPhone; **PC on Ethernet** to the same router.\\\n* Disable power-save on ESP32; keep nodes in same room as AP.\\\n* Packet loss? Drop to 100 Hz; keep packets tiny; kill background cloud crap on the PC.\\\n\\\n---\\\n\\\n## 6. Host Software Stack\\\n\\\n### 6.1 SlimeVR Server\\\n\\\n* Runs on the PC. Receives node quats over UDP, does body solve, exposes outputs to your engine (OpenVR/OSC/VRChat bridges exist; for Unreal/Unity use the plugin/connector you prefer).\\\n* Use the server’s **Mounting/Alignment** tool after you strap in.\\\n\\\n### 6.2 Facial Capture (ARKit)\\\n\\\n* **Device:** iPhone with TrueDepth (FaceID).\\\n* **App:** any ARKit face app that streams blendshapes (e.g., Live Link Face for Unreal; for Unity/Blender use an OSC/UDP sender app or a bridge).\\\n* **Configuration:**\\\n\\\n  * Ensure **same LAN** as the PC.\\\n  * **Disable ARKit head pose** in the engine if it conflicts—remember the head IMU owns head rotation.\\\n  * Map ARKit blendshape names → your facial rig (one-time setup).\\\n\\\n### 6.3 Engine Integration (pick one)\\\n\\\n**Unreal (recommended for live)**\\\n\\\n* Inputs: SlimeVR (via OpenVR/OSC/Live Link bridge) + ARKit (Live Link Face).\\\n* Use **Control Rig** to apply IMU rotations to bones; facial blendshapes through Live Link.\\\n* Export via Take Recorder or bake to Control Rig → FBX.\\\n\\\n**Unity**\\\n\\\n* Inputs: SlimeVR (OSC/OpenVR bridge) + ARKit (OSC/UDP).\\\n* Apply quats with **FinalIK**/custom scripts; drive blendshapes via mapping component.\\\n* Record with Timeline/Recorder.\\\n\\\n**Blender (best offline)**\\\n\\\n* Import SlimeVR quats (CSV/OSC capture) → drivers/constraints.\\\n* Import ARKit curves → shape keys.\\\n* Clean, then export FBX.\\\n\\\n---\\\n\\\n## 7. Time Sync & Latency Strategy\\\n\\\n* IMU stream ≈ **20–40 ms** pipeline; ARKit ≈ **40–70 ms**.\\\n* For live preview, **buffer faster stream to the slower** (usually ARKit).\\\n* If you don’t want to build fancy sync: **accept 1–2 frames of mis-alignment**. For offline, record raw and align in post.\\\n\\\n---\\\n\\\n## 8. Calibration & Session Workflow\\\n\\\n**Before first use (per node):**\\\n\\\n1. Power on, warm up 1–2 min.\\\n2. Stationary bias (don’t touch). Save to NVS.\\\n\\\n**Each session:**\\\n\\\n1. Charge everything. Mount nodes consistently (follow the arrows).\\\n2. Launch SlimeVR Server; connect nodes.\\\n3. **T-pose alignment** in server; verify axes (elbows bend the right way).\\\n4. Start ARKit face app; confirm blendshapes arrive; disable head pose if needed.\\\n5. Do a **walk/arm-swing test**; let stillness rebias fire after 10–20 s of standing.\\\n6. Record: capture **raw** (optional) + final (engine).\\\n7. Between takes: keep stillness rebias on; long breaks → power-cycle nodes.\\\n\\\n---\\\n\\\n## 9. Data Formats & Rates\\\n\\\n**Tracker packet (suggested; SlimeVR uses its own but conceptually this):**\\\n\\\n```c\\\nstruct PosePkt {\\\n  uint32_t t_us;            // monotonic timestamp (microseconds)\\\n  int16_t qx, qy, qz, qw;   // quaternion (Q15)\\\n  uint8_t id;               // tracker ID\\\n  uint8_t flags;            // calib_ok, fifo_overrun, etc.\\\n}; // ~20–22 bytes\\\n```\\\n\\\n* **Rate:** 100–200 Hz per node.\\\n* **Total throughput:** trivial on 5 GHz (dozens of kB/s).\\\n\\\n---\\\n\\\n## 10. Rig & Retargeting\\\n\\\n* **One skeleton**. Don’t mix bone names/axes across tools.\\\n* **Scale** once; keep consistent.\\\n* **Head ownership**: IMU drives head rotation; ARKit drives shapes.\\\n* **Feet**: with IMU-only rigs, some skate is inevitable; use IK foot pins/constraints in engine to help.\\\n\\\n---\\\n\\\n## 11. Quality Tips (What Actually Matters)\\\n\\\n* **Rigid mounts** > everything. Wobble = garbage data.\\\n* **Mag off** indoors. Yaw drift? Use stillness rebias; keep takes sane length.\\\n* **Dedicated Wi-Fi**. PC wired. No walls/metal racks between AP and actor.\\\n* **Warm-up** before alignment.\\\n* **Consistent don/doff**: same strap spots, same arrow directions, every time.\\\n\\\n---\\\n\\\n## 12. Troubleshooting\\\n\\\n| Symptom            | Cause                         | Fix                                                                             |\\\n| ------------------ | ----------------------------- | ------------------------------------------------------------------------------- |\\\n| Slow turning drift | Gyro bias, mag disabled       | Let stillness rebias trigger; keep takes shorter; power-cycle if it gets silly. |\\\n| Arms bend wrong    | Mount orientation mismatch    | Re-run mounting tool; fix case arrows; remap axes in server.                    |\\\n| Stutter / lag      | Wi-Fi congestion / power-save | Dedicated 5 GHz, disable ESP power-save, drop to 100 Hz, wire PC.               |\\\n| Feet slide         | IMU-only limitation           | Use stronger IK foot pins; prefer **foot** nodes (not shins).                   |\\\n| Head “fights” face | Double-driving                | IMU owns head rotation; apply ARKit shapes as local offsets only.               |\\\n| One tracker noisy  | Loose strap / EMI             | Tighten, move away from magnets, check wiring, swap LiPo if sagging.            |\\\n\\\n---\\\n\\\n## 13. Maintenance & Safety\\\n\\\n* Inspect straps, cases, and JST leads weekly.\\\n* Store LiPos at ~50% if shelving for weeks.\\\n* Keep batteries insulated from PCB edges; don’t crush/crease pouches.\\\n* Replace swollen or weak packs. Common sense.\\\n\\\n---\\\n\\\n## 14. Extensions & Variants\\\n\\\n* **More nodes (12)**: add upper legs or shins if you prefer; minor gain vs complexity.\\\n* **Hands/fingers**: separate system (Leap, gloves).\\\n* **Absolute position**: add a single anchor (UWB, lighthouse hip puck) later. Not covered here.\\\n\\\n---\\\n\\\n## 15. Quick Checklists\\\n\\\n**Build (per node)**\\\n\\\n* [ ] ESP32-S3 + BNO085 wired (SPI preferred), short leads\\\n* [ ] Case printed, arrows marked, strap fitted\\\n* [ ] LiPo + switch + charge verified\\\n* [ ] Firmware flashed, unique ID set\\\n* [ ] Warm-up + bias saved\\\n\\\n**Session**\\\n\\\n* [ ] All nodes charged & mounted (same spots)\\\n* [ ] SlimeVR Server running; nodes green\\\n* [ ] T-pose alignment passed (axes correct)\\\n* [ ] ARKit face connected; head pose disabled if needed\\\n* [ ] Quick walk test; stillness rebias confirmed\\\n* [ ] Record raw (optional) + final\\\n\\\n---\\\n\\\n### Final word\\\n\\\nThis setup is **portable, cheap, and expressive**. You won’t get absolute world positions; you **will** get clean rotations and a great face. Keep mounts rigid, Wi-Fi clean, and sessions sane. If later you need drift-free root/feet, we can bolt on one anchor system—but you don’t need it to ship solid results with this rig.\\\n\"]],\"start1\":0,\"start2\":0,\"length1\":0,\"length2\":11536}]"
metadata_diff: {"new":{"id":"3a3bd26629174b1aa1a8e3876b58869f","parent_id":"7281cae0eaec48078ff2080548ab7931","latitude":"30.43825590","longitude":"-84.28073290","altitude":"0.0000","author":"","source_url":"","is_todo":0,"todo_due":0,"todo_completed":0,"source":"joplin-desktop","source_application":"net.cozic.joplin-desktop","application_data":"","order":0,"markup_language":1,"is_shared":0,"share_id":"","conflict_original_id":"","master_key_id":"","user_data":"","deleted_time":0},"deleted":[]}
encryption_cipher_text: 
encryption_applied: 0
updated_time: 2025-09-28T18:23:32.053Z
created_time: 2025-09-28T18:23:32.053Z
type_: 13